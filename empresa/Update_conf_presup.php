<?include ("../class/conect.php"); include ("../class/funciones.php");
$MControl = array (0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
$campo501=$_POST["txtcod_modulo"]; $campo502=""; $campo503=$_POST["txtperiodo"];  $campo503=$_POST["txtperiodo"]; $campo504=$_POST["txtformato_pre"]; $campo525=$_POST["txttitulo"]; $campo550=$_POST["txtlong_cat"]; $campo552=$_POST["txtnivel"];  $campo534=$_POST["txtporc_traspaso"]; $campo553=$_POST["txtnivel_traspaso"];
$campo=$_POST["txtsolo_num"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtref_comp"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtfecha_comp"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtgen_comp"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtref_caus"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtfecha_caus"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtref_pago"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtfecha_pago"];$campo=substr($campo,0,1);$campo502=$campo502.$campo;
$campo=$_POST["txtref_ajuste"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtfecha_ajuste"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtref_mod"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtfecha_mod"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtpreg_cod"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtcorr_modif"];$campo=substr($campo,0,1);$campo502=$campo502.$campo; $campo=$_POST["txtmodif_aprob"];$campo=substr($campo,0,1);$campo502=$campo502.$campo;    $campo=$_POST["txtaprob_comp"];$campo=substr($campo,0,1);$campo502=$campo502.$campo;
$campo505=$_POST["txtnombcat1"];$campo506=$_POST["txtabrevcat1"]; $campo507=$_POST["txtnombcat2"];$campo508=$_POST["txtabrevcat2"]; $campo509=$_POST["txtnombcat3"];$campo510=$_POST["txtabrevcat3"]; $campo511=$_POST["txtnombcat4"];$campo512=$_POST["txtabrevcat4"]; $campo513=$_POST["txtnombcat5"];$campo514=$_POST["txtabrevcat5"]; $campo515=$_POST["txtnombpar1"];$campo516=$_POST["txtabrevpar1"]; $campo517=$_POST["txtnombpar2"];$campo518=$_POST["txtabrevpar2"]; $campo519=$_POST["txtnombpar3"];$campo520=$_POST["txtabrevpar3"]; $campo521=$_POST["txtnombpar4"];$campo522=$_POST["txtabrevpar4"]; $campo523=$_POST["txtnombpar5"];$campo524=$_POST["txtabrevpar5"];
$campo549=strlen($campo504); $j=0;for ($i=0; $i<strlen($campo504); $i++) {if (substr($campo504,+$i,1)=="-") {$j++;}} $campo551=$j-$campo550+1;
$campo525=$campo506; if(strlen($campo508)>0){$campo525=$campo525.'-'.$campo508;}  if(strlen($campo510)>0){$campo525=$campo525.'-'.$campo510;} if(strlen($campo512)>0){$campo525=$campo525.'-'.$campo512;} if(strlen($campo514)>0){$campo525=$campo525.'-'.$campo514;} if(strlen($campo516)>0){$campo525=$campo525.'-'.$campo516;} if(strlen($campo518)>0){$campo525=$campo525.'-'.$campo518;} if(strlen($campo520)>0){$campo525=$campo525.'-'.$campo520;} if(strlen($campo522)>0){$campo525=$campo525.'-'.$campo522;} if(strlen($campo524)>0){$campo525=$campo525.'-'.$campo524;}
$campo572=$_POST["txtdoc_dif"]; 
$j=0;for ($i=0; $i<10; $i++) {$MControl[$i]=0;} for ($i=0; $i<strlen($campo504); $i++) {if (substr($campo504,+$i, 1) == "-") {$j++;} else{$MControl[$j]++;} } $Ultimo=$j;$k=$MControl[0];
for ($i=1; $i<10; $i++) {if ($MControl[$i] == 0) {$MControl[$i]=0;} else { $j=$MControl[$i]+$k; $MControl[$i]=$j+1; $k=$MControl[$i];}}for ($i=1; $i<10; $i++) {if ($MControl[$i] < 0) {$MControl[$i]=0;}}
$cat=$MControl[$campo550-1]; $par=strlen($campo504)-$cat; $campo526=substr($campo504,0,$cat);$campo527=substr($campo504,$cat+1,$par);
$fecha=asigna_fecha_hoy(); if($fecha==""){$sfecha="2007-01-01";}else{$sfecha=formato_aaaammdd($fecha);} $monto=formato_numero($campo550); if(is_numeric($monto)){$campo550=$monto;} else{$campo550=0;} $monto=formato_numero($campo552); if(is_numeric($monto)){$campo552=$monto;} else{$campo552=0;} $monto=formato_numero($campo534); if(is_numeric($monto)){$campo534=$monto;}else{$campo534=0;} $monto=formato_numero($campo553); if(is_numeric($monto)){$campo553=$monto;} else{$campo553=0;}
$url="Act_Conf_Contab_Presup.php"; echo "ESPERE POR FAVOR MODIFICANDO....","<br>"; $error=0;
$conn = pg_connect("host=".$host." port=".$port." password=".$password." user=".$user." dbname=".$dbname."");
if (pg_ErrorMessage($conn)) { ?> <script language="JavaScript">   muestra('OCURRIO UN ERROR CONECTANDO LA BASE DE DATOS');  </script> <?}
 else{ $error=0;
  if($campo550==0){$error=1; ?> <script language="JavaScript"> muestra('LONGITUD DE CATEGORIA INVALIDA');</script> <? }
  if($campo551==0){$error=1; ?> <script language="JavaScript"> muestra('LONGITUD DE PARTIDAS INVALIDA');</script> <? }
  if(strlen($campo525)==strlen($campo504)){$error=$error;}else{echo $campo525.' '.$campo504; $error=1; ?> <script language="JavaScript"> muestra('DEFINCION DE NIVELES NO VALIDA');</script> <? }
  if($error==0){$sSQL="Select * from SIA005 where campo501='$campo501'";  $resultado=pg_exec($conn,$sSQL);  $filas=pg_numrows($resultado);
  if($filas==0){$error=1; ?> <script language="JavaScript"> muestra('CONFIGURACIÓN NO EXISTE');</script> <? }
   else{$error=0;$sql="SELECT MODIFICA_SIA005('$campo501','$campo502','$campo503','$campo504','$campo505','$campo506','$campo507','$campo508','$campo509','$campo510','$campo511','$campo512','$campo513','$campo514','$campo515','$campo516','$campo517','$campo518','$campo519','$campo520','$campo521','$campo522','$campo523','$campo524','$campo525','$campo526','$campo527','','','','','','',$campo534,0,0,0,0,0,0,0,0,0,0,0,0,0,0,$campo549,$campo550,$campo551,$campo552,$campo553,0,0,0,0,0,'$sfecha','$sfecha','$sfecha','$sfecha','$sfecha','$sfecha','$sfecha','$sfecha','$sfecha','$sfecha','A','','','$campo572','')"; $resultado=pg_exec($conn,$sql);$error=pg_errormessage($conn); $error=substr($error, 0, 61);
     if (!$resultado){?> <script language="JavaScript"> muestra('<? echo $error; ?>'); </script> <? } else{ ?> <script language="JavaScript"> muestra('MODIFICO EXITOSAMENTE'); </script><? $error=0; }
  }}
}pg_close();?> <script language="JavaScript"> LlamarURL('<?echo $url;?>'); </script>
